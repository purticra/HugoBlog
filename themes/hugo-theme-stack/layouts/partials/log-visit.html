<script>
function sendLocationToGA(position) {
  gtag('event', 'user_location', {
    page_path: window.location.pathname,
    latitude: position.coords.latitude,
    longitude: position.coords.longitude,
    accuracy: position.coords.accuracy
  });
}

function requestGPSAndLog() {
  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(
      sendLocationToGA, // 用户允许时调用
      err => {
        console.warn("GPS 获取失败或用户拒绝:", err);
        // 可以发送空值事件
        gtag('event', 'user_location', {
          page_path: window.location.pathname,
          latitude: null,
          longitude: null,
          accuracy: null
        });
      },
      { enableHighAccuracy: true, timeout: 10000 } // 高精度 & 超时
    );
  } else {
    console.warn("浏览器不支持 GPS");
  }
}

// 页面加载后请求 GPS
document.addEventListener("DOMContentLoaded", requestGPSAndLog);
</script>
